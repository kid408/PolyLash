# PolyLash 项目文档

## 项目概述

PolyLash 是一款使用 Godot 4.x 开发的 2D 动作生存游戏。玩家需要在无限生成的地图中对抗波次敌人，通过打开宝箱获得属性升级，生存尽可能多的波次。

## 游戏特性

### 核心玩法
- **波次生存系统**: 10波敌人，每波难度递增
- **无限地图**: 动态生成的无缝平铺地图
- **宝箱系统**: 4个品质等级的宝箱，提供属性升级
- **多角色系统**: 7个可玩角色，每个角色有独特技能
- **属性升级**: 通过宝箱选择升级，增强角色能力
- **动态生成**: 敌人在玩家附近动态生成，保持战斗紧张感
- **打击感系统**: 顿帧、屏幕震动、音效反馈，提供爽快的战斗体验

### 技术特性
- **CSV配置驱动**: 所有游戏数据通过CSV配置
- **模块化设计**: 清晰的代码结构和组件系统
- **音效系统**: 可配置的音效管理
- **UI系统**: 完整的游戏UI和反馈系统

## 项目结构

```
PolyLash_Project/
├── assets/              # 游戏资源
│   ├── audio/          # 音效文件
│   └── sprites/        # 图片资源
├── autoloads/          # 全局单例脚本
│   ├── config_manager.gd    # 配置管理器
│   ├── global.gd            # 全局变量和工具
│   ├── sound_manager.gd     # 音效管理器
│   └── upgrade_manager.gd   # 升级管理器
├── config/             # CSV配置文件
│   ├── player_config.csv        # 玩家配置
│   ├── enemy_config.csv         # 敌人配置
│   ├── weapon_config.csv        # 武器配置
│   ├── upgrade_attributes.csv   # 升级属性配置
│   ├── chest_config.csv         # 宝箱配置
│   ├── wave_chest_config.csv    # 波次宝箱配置
│   └── sound_config.csv         # 音效配置
├── scenes/             # 游戏场景
│   ├── arena/          # 竞技场相关
│   ├── items/          # 物品（宝箱等）
│   ├── ui/             # 用户界面
│   └── unit/           # 单位（玩家、敌人）
└── tools/              # 开发工具

```

## 快速开始

### 运行游戏
1. 使用 Godot 4.x 打开项目
2. 按 F5 运行游戏
3. 使用 WASD 移动，鼠标左键冲刺
4. Q键和E键使用技能（不同角色技能不同）

### 游戏操作
- **WASD**: 移动
- **鼠标左键**: 冲刺攻击
- **Q键**: 技能1（按住蓄力，松开释放）
- **E键**: 技能2
- **L键**: 进入下一波（测试功能）
- **Tab键**: 切换角色（调试功能）
- **1-6键**: 切换武器槽位（调试功能）

## 游戏系统详解

### 1. 波次系统
- 共10波敌人
- 每波有固定时间限制
- 波次结束后自动进入下一波
- 完成10波后游戏胜利
- 敌人在玩家附近动态生成
- 按L键可立即进入下一波（测试功能）

### 2. 宝箱系统
- **4个品质等级**:
  - 木宝箱（白色）- 等级1
  - 青铜宝箱（青色）- 等级2
  - 黄金宝箱（黄色）- 等级3
  - 钻石宝箱（彩虹色）- 等级4
- 宝箱根据波次动态生成
- 宝箱之间保持最小距离（500像素），避免重叠
- 触碰宝箱自动打开
- 选择3个属性升级之一
- 高级宝箱提供的属性提升是低级宝箱的10-15倍

### 3. 属性升级系统
可升级的属性包括：
- **基础属性**:
  - 最大生命值
  - 最大能量
  - 能量恢复速度
  - 移动速度
- **冲刺属性**:
  - 冲刺距离
  - 冲刺伤害
  - 冲刺消耗降低
- **技能属性**:
  - Q技能消耗降低
  - E技能消耗降低
- **战斗属性**:
  - 武器伤害加成
  - 暴击率
  - 暴击伤害
  - 伤害减免
  - 生命偷取
  - 击杀回能

**升级反馈**:
- 属性升级后立即生效
- UI（血条、能量条）实时更新
- 控制台显示详细的升级日志（属性名称、当前值、增加值、最终值）

### 4. 角色系统
7个可玩角色：
1. **Herder（牧者）**: 冲刺留下裂痕，可回拉敌人
2. **Butcher（屠夫）**: 电锯冲刺，死亡角斗场
3. **Weaver（织网者）**: 蛛网陷阱，范围控制
4. **Pyro（烈焰）**: 火焰技能，范围伤害
5. **Wind（疾风）**: 风系技能，高机动性
6. **Sapper（工兵）**: 陷阱和爆炸物
7. **Tempest（风暴）**: 雷电技能，群体伤害

### 5. 音效系统
- 所有音效通过CSV配置
- 支持音量和音调调整
- 音效文件不存在时不会崩溃
- 使用对象池优化性能
- 随机音调变化，增加音效丰富度

### 6. 打击感系统
- **顿帧效果**: 攻击和受击时的时间冻结
- **屏幕震动**: 根据伤害大小动态调整震动强度
- **音效反馈**: 攻击、受击、死亡的音效提示
- **视觉反馈**: 闪白、粒子效果、飘字提示
- **玩家受击反馈**: 
  - 护甲破碎：轻微震动和顿帧
  - 无护甲受伤：强烈震动和明显顿帧
- **敌人受击反馈**: 根据伤害大小调整反馈强度
- **敌人死亡反馈**: 增强的震动、顿帧和音效

## 配置系统

所有游戏数据都通过CSV文件配置，详见 [CSV_CONFIG_GUIDE.md](CSV_CONFIG_GUIDE.md)

主要配置文件：
- `player_config.csv` - 玩家角色属性
- `enemy_config.csv` - 敌人属性
- `weapon_config.csv` - 武器属性
- `upgrade_attributes.csv` - 升级属性
- `chest_config.csv` - 宝箱配置
- `wave_chest_config.csv` - 波次宝箱生成规则
- `sound_config.csv` - 音效配置

## 开发文档

- **CSV配置指南**: [CSV_CONFIG_GUIDE.md](CSV_CONFIG_GUIDE.md) - 详细的CSV配置文件说明
- **API文档**: [API_DOCUMENTATION.md](API_DOCUMENTATION.md) - 所有类和函数的中文文档
- **项目概述**: 本文档 (README.md)

## 调试功能

### 测试快捷键
- **L键**: 立即进入下一波（跳过当前波次剩余时间）
- **Tab键**: 切换角色（在7个角色之间循环）
- **1-6键**: 切换武器槽位（查看不同武器）

### 控制台日志
游戏运行时会在控制台输出详细的调试信息：
- 属性升级日志（属性名称、当前值、增加值、最终值）
- 波次切换日志
- 敌人生成日志
- 宝箱生成日志
- 音效播放日志

## 当前进度

### 已完成功能 ✅
- [x] 基础玩家移动和冲刺系统
- [x] 7个可玩角色及其独特技能
- [x] 波次生存系统（10波）
- [x] 无限地图生成
- [x] 宝箱系统（4个品质等级）
- [x] 属性升级系统（实时生效，UI更新）
- [x] 敌人生成和AI（玩家附近动态生成）
- [x] 碰撞和伤害系统
- [x] UI系统（生命条、能量条、波次显示）
- [x] 宝箱指示器（屏幕边缘箭头）
- [x] 音效系统（CSV配置，随机音调）
- [x] CSV配置系统（所有数据可配置）
- [x] 打击感系统（顿帧、屏幕震动、音效反馈）
- [x] 玩家击退优化（快速衰减，减少被推动感）
- [x] 测试功能（L键进入下一波）

### 待优化功能 🔄
- [ ] 更多敌人类型和AI行为
- [ ] 更多武器类型和攻击方式
- [ ] Boss战系统
- [ ] 成就系统
- [ ] 存档系统
- [ ] 更多音效和背景音乐
- [ ] 粒子特效优化
- [ ] 性能优化（大量敌人时）
- [ ] 多语言支持

### 已知问题 🐛
- 无重大已知问题

## 技术栈

- **引擎**: Godot 4.x
- **语言**: GDScript
- **配置**: CSV
- **音效格式**: WAV/OGG
- **图片格式**: PNG

## 贡献指南

### 添加新角色
1. 在 `config/player_config.csv` 添加角色配置
2. 创建角色脚本继承 `PlayerBase`
3. 实现 `charge_skill_q()`, `release_skill_q()`, `use_skill_e()`
4. 创建角色场景并设置 `player_id`

### 添加新敌人
1. 在 `config/enemy_config.csv` 添加敌人配置
2. 创建敌人脚本继承 `Enemy`
3. 实现敌人AI逻辑
4. 创建敌人场景

### 添加新音效
1. 将音效文件放入 `assets/audio/`
2. 在 `config/sound_config.csv` 添加配置
3. 使用 `SoundManager.play_sound("sound_id")` 播放

## 许可证

[待定]

## 联系方式

[待定]

---

**最后更新**: 2024年12月28日
**版本**: 1.0.0
**状态**: 开发中
