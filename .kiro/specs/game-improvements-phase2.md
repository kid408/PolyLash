# 游戏改进 - 第二阶段优化

## 概述
继续优化Gemini建议的游戏改进功能，重点解决用户反馈的问题。

## 当前状态
✅ 已完成：
- 指向性震动系统（已降低强度）
- 伤害数字合并（需要优化）
- 画圈奖励机制（已修复信号问题）
- 地雷怪代码实现（需要验证）
- 飘字效果优化

## 待完成任务

### 1. ✅ 优化伤害数字合并 (已完成)
**改进内容**:
- ✅ 增加累积时间：0.3秒 → 0.5秒
- ✅ 增加连击计数系统
- ✅ 增大字体缩放：根据伤害值动态调整（1.5-3.0倍）
- ✅ 高伤害时增加震动和顿帧反馈
- ✅ 持续攻击会重置计时器，延长显示时间

**文件**: `scenes/unit/unit.gd` (已修改)

### 2. 修复地雷怪问题 (高优先级)
**问题**: 将ChaserMid的enemy_type改为MINE_LAYER后没有效果

**排查方向**:
1. 检查enemy.gd中的destroy_enemy()函数是否正确触发
2. 确认enemy_type是否正确设置为4 (MINE_LAYER)
3. 检查CSV配置是否正确加载
4. 可能需要在场景文件中设置enemy_type，而不仅仅是CSV

**文件**: `scenes/unit/enemy/enemy.gd`, `config/enemy_config.csv`

### 3. ⚠️ 添加能量槽UI (部分完成，需要手动操作)
**已完成**:
- ✅ 创建 `scenes/ui/energy_bar.gd`
- ✅ 实现能量槽逻辑

**需要手动操作**:
1. 在Godot编辑器中复制 `health_bar.tscn` 为 `energy_bar.tscn`
2. 修改场景的脚本为 `energy_bar.gd`
3. 修改颜色为蓝色
4. 添加到主UI场景
5. 连接信号：`PlayerBase.energy_changed` → `EnergyBar._on_player_energy_changed`

**参考文件**: `scenes/ui/health_bar.gd`, `scenes/ui/energy_bar.gd` (已创建)

### 4. 添加技能CD提示UI (中优先级)
**需求**: 显示Q技能和E技能的冷却时间

**实现步骤**:
1. 在PlayerBase中添加CD追踪变量
2. 创建CD显示UI组件
3. 实时更新CD状态

### 5. 调整数值平衡 (低优先级)
**问题**: 玩家血量5000和能量999太高

**调整方案**:
- 参考《土豆兄弟》的数值设计
- 降低玩家生命值：5000 → 建议100-200
- 降低玩家能量值：999 → 建议100
- 相应调整敌人数值
- 调整技能消耗和伤害值

**文件**: `config/player_config.csv`, `config/enemy_config.csv`

## 验证方法

### 伤害数字合并
1. 启动游戏
2. 攻击敌人
3. 观察伤害数字是否更大、更明显、更爽快

### 地雷怪
1. 找到地雷怪（enemy_type=4）
2. 击杀它
3. 观察是否生成绿色毒池
4. 站在毒池中是否持续受到伤害

### 能量槽UI
1. 启动游戏
2. 检查UI是否显示能量槽
3. 使用技能后能量槽是否正确减少
4. 能量恢复时是否正确显示

## 技术细节

### 伤害合并系统当前实现
- 累积时间：0.3秒
- 颜色分级：白色(<50) / 黄色(50-99) / 橙色(100+)
- 位置：主角四周随机±40像素
- 字体：1.2-2.0倍

### 地雷怪当前实现
- 类型：EnemyType.MINE_LAYER (4)
- 毒池半径：60像素
- 持续时间：8秒
- 伤害：每0.5秒5点
- 视觉：绿色半透明圆形

### 能量系统
- 信号：`energy_changed(current, max_val)`
- 恢复速度：0.5/秒
- 最大值：999（需要调整）
- 初始值：根据角色不同（500-800）
