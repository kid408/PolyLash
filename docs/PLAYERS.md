# 玩家角色系统详解

本文档详细介绍PolyLash中的7个可玩角色及其技能机制。

---

## 目录

- [角色系统概述](#角色系统概述)
- [角色列表](#角色列表)
  - [1. Herder（牧者）](#1-herder牧者)
  - [2. Butcher（屠夫）](#2-butcher屠夫)
  - [3. Weaver（织网者）](#3-weaver织网者)
  - [4. Pyro（烈焰）](#4-pyro烈焰)
  - [5. Wind（御风者）](#5-wind御风者)
  - [6. Sapper（工兵）](#6-sapper工兵)
  - [7. Tempest（风暴使者）](#7-tempest风暴使者)
- [角色属性系统](#角色属性系统)
- [技能系统](#技能系统)
- [公共工具类](#公共工具类)
- [角色选择建议](#角色选择建议)

---

## 角色系统概述

### 设计理念

每个角色都有独特的技能机制和玩法风格，从几何控制到火焰法术，从陷阱布置到雷电风暴，提供多样化的游戏体验。

### 共同特性

所有角色共享以下基础机制：

- **移动**: WASD键控制移动
- **冲刺**: 鼠标左键向鼠标方向冲刺并造成伤害
- **Q技能**: 按住Q进入规划模式（子弹时间0.1倍速），按住鼠标左键划线，松开Q执行
- **E技能**: 立即释放的技能
- **能量系统**: 技能消耗能量，能量自动恢复，击杀敌人获得能量
- **护甲系统**: 最多3点护甲，减少受到的伤害

### Q技能通用机制

所有角色的Q技能都采用统一的划线机制：

1. **按住Q键**: 进入规划模式，时间流速降至0.1倍
2. **按住鼠标左键**: 在屏幕上连续划线，每10像素消耗1点能量
3. **能量递增**: 超过1800像素后，能量消耗逐渐递增
4. **闭合检测**: 实时检测线段交叉，形成闭合区域时线条变红
5. **支持8字形**: 可以画出8字形等多个闭合区域，每个区域独立触发效果
6. **右键取消**: 按右键清除所有路径并返还能量
7. **松开Q键**: 执行技能效果（冲刺/发射/部署等）

### 角色切换

- 按 **Tab键** 可在7个角色之间循环切换（调试功能）
- 切换后保留当前波次和升级

---

## 角色列表

### 1. Herder（牧者）

<div align="center">

**几何控制专家 | 区域控制 + 高爆发**

</div>

#### 角色定位

牧者是一个需要规划和预判的高风险高回报角色。通过规划冲刺路径形成闭环，可以瞬间消灭圈内所有敌人。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 100 |
| 移动速度 | 500 |
| 最大能量 | 999 |
| 初始能量 | 500 |
| 能量恢复 | 0.5/秒 |
| 最大护甲 | 3 |

#### 技能详解

##### 左键 - 冲刺攻击
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 向鼠标方向冲刺，对路径上的敌人造成伤害

##### Q技能 - 几何绞杀
- **类型**: 规划技能
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键执行冲刺路径
- **效果**:
  - 沿规划路径冲刺
  - 如果路径形成闭环，触发"闭环绞杀"
  - **闭环绞杀**: 瞬杀圈内所有敌人（刺猬免疫）
  - **支持8字形**: 可以画出多个闭合区域，每个区域独立触发
- **视觉**: 规划时显示白色线条，闭合时变红色，执行时显示红色遮罩
- **动态速度**: 路径越长，冲刺速度越快（最高3倍）

##### E技能 - 范围爆炸
- **类型**: 范围伤害
- **消耗**: 30能量
- **效果**:
  - 以自身为中心的大范围爆炸（200像素半径）
  - 造成伤害并击退敌人
  - 成功击杀敌人后恢复1点护甲
- **冷却**: 无冷却

#### 玩法技巧

1. **规划路径**: 在敌人密集区域规划闭环，一次性清场
2. **8字形技巧**: 画8字形可以同时触发两个闭合区域
3. **能量管理**: 规划路径消耗大量能量，注意能量余量
4. **护甲恢复**: 使用E技能击杀敌人恢复护甲
5. **动态速度**: 长路径冲刺更快，适合快速穿越战场

#### 适合玩家

- 喜欢策略和规划的玩家
- 追求高风险高回报的玩家
- 擅长预判敌人位置的玩家

---

### 2. Butcher（屠夫）

<div align="center">

**锯条狂魔 | 区域控制 + 敌人捕获**

</div>

#### 角色定位

屠夫通过规划路径发射锯条，可以捕获并拉扯敌人。闭合路径时锯条会钉在终点持续伤害，非闭合时像刮板一样推着敌人走。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 400 |
| 冲刺速度 | 2000 |
| 冲刺伤害 | 20 |
| 最大能量 | 999 |
| 初始能量 | 800 |

#### 技能详解

##### 左键 - 普通冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 快速位移，造成伤害

##### Q技能 - 锯条路径
- **类型**: 规划技能
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键发射锯条
- **效果**:
  - **闭合状态**: 锯条飞向路径中心，捕获并拉扯敌人，钉在终点8秒持续伤害
  - **非闭合状态**: 锯条像刮板一样推着敌人走，到达终点立即消失
  - **支持8字形**: 可以画出多个闭合区域
- **参数**:
  - 锯条飞行速度: 1100
  - 闭合伤害: 3/tick
  - 非闭合伤害: 1/tick
  - 链条控制半径: 250
  - 推动/命中半径: 80（可配置）
- **视觉**: 规划时白色线条，闭合时变红色，执行时显示红色遮罩
- **特殊**: 再次按Q可手动消除已发射的锯条

##### E技能 - 范围爆炸
- **类型**: 范围伤害
- **消耗**: 30能量
- **效果**:
  - 以自身为中心的大范围爆炸
  - 造成伤害并击退敌人
  - 成功击杀敌人后恢复护甲
- **冷却**: 无冷却

#### 玩法技巧

1. **闭合捕获**: 画闭合路径捕获敌人，锯条会持续8秒伤害被困敌人
2. **刮板推怪**: 非闭合路径可以像刮板一样推着敌人走，适合聚怪
3. **8字形技巧**: 画8字形可以同时触发两个闭合区域
4. **手动消除**: 再次按Q可以提前消除锯条，灵活控制战场
5. **飞行方向**: 锯条从玩家位置飞向路径中心，注意规划路径位置

#### 适合玩家

- 喜欢捕获和控制敌人的玩家
- 擅长规划和预判的玩家
- 喜欢灵活战术的玩家

---

### 3. Weaver（织网者）

<div align="center">

**蛛网陷阱大师 | 两阶段技能 + 处决伤害**

</div>

#### 角色定位

织网者通过规划路径编织蛛网，形成闭合区域时定身敌人。技能分为编织和收割两个阶段，收网时对被困敌人造成处决伤害。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 320 |
| 冲刺速度 | 1600 |
| 冲刺伤害 | 12 |
| 最大能量 | 999 |
| 初始能量 | 600 |

#### 技能详解

##### 左键 - 普通冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 快速位移，造成伤害

##### Q技能 - 蛛网编织与收割（两阶段）

**阶段一（编织）**:
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键部署蛛网
- **效果**:
  - 蛛网滞留8秒
  - 闭合区域内的敌人被定身+易伤标记
  - **支持8字形**: 可以画出多个闭合区域
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）

**阶段二（收割）**:
- **触发**: 再次按Q或8秒后自动触发
- **效果**:
  - 蛛网收缩回玩家位置
  - 路径上的敌人受到40点伤害
  - **被困敌人受到处决伤害（3倍）**: 120点
- **视觉**: 蛛网线条收缩动画

##### E技能 - 蜘蛛地雷
- **类型**: 陷阱
- **消耗**: 30能量
- **效果**:
  - 在脚下放置陷阱（持续10秒）
  - 敌人触发后范围爆炸
  - 爆炸范围内所有敌人被禁锢3秒
  - 造成伤害
- **用途**: 控制敌人移动，配合Q技能

#### 玩法技巧

1. **编织陷阱**: 画闭合区域困住敌人，等待更多敌人进入
2. **处决时机**: 等待敌人聚集后再收网，最大化处决伤害
3. **8字形技巧**: 画8字形可以同时困住两个区域的敌人
4. **地雷配合**: 提前布置地雷，引导敌人进入蛛网区域
5. **手动收网**: 可以提前按Q收网，灵活控制时机

#### 适合玩家

- 喜欢控制和陷阱的玩家
- 擅长时机把握的玩家
- 喜欢高爆发处决的玩家

---

### 4. Pyro（烈焰）

<div align="center">

**火焰法师 | 持续伤害 + 区域封锁**

</div>

#### 角色定位

烈焰通过规划路径冲刺，沿途生成火线。形成闭环时创造火海，造成更高伤害并根据圈内敌人数量给予奖励。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 300 |
| 冲刺速度 | 1200 |
| 冲刺伤害 | 10 |
| 最大能量 | 999 |
| 初始能量 | 700 |

#### 技能详解

##### 左键 - 普通冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 快速位移，造成伤害

##### Q技能 - 火线规划
- **类型**: 规划技能
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键执行冲刺
- **效果**:
  - 沿途生成火线（持续5秒，造成20点/tick伤害）
  - 如果形成闭环，创造火海（40点/tick伤害，持续5秒）
  - **支持8字形**: 可以画出多个闭合区域，每个区域独立触发火海
- **视觉**: 规划时金橙色线条，闭合时变红色
- **画圈奖励**:
  - 小圈（1-2个怪）: 返还80%能量，显示"GOOD!"
  - 中圈（3-9个怪）: 返还50%能量，显示"PERFECT!"
  - 大圈（10+个怪）: +3护甲，+15生命，显示"DIVINE!"

##### E技能 - 烈焰新星
- **类型**: 范围伤害
- **消耗**: 20能量
- **效果**:
  - 以自身为中心的火焰爆发（140像素半径）
  - 大范围持续伤害（3秒）
  - 造成35点伤害
- **用途**: 紧急清场、近战防御

#### 玩法技巧

1. **火线封锁**: 规划火线封锁敌人路径
2. **火海创造**: 在敌人密集区域画闭环创造火海
3. **8字形技巧**: 画8字形可以同时触发两个火海
4. **画圈奖励**: 根据圈内敌人数量获得不同奖励，大圈可恢复护甲和生命
5. **紧急清场**: 使用E技能清理近身敌人

#### 适合玩家

- 喜欢持续伤害的玩家
- 擅长区域控制的玩家
- 新手友好（技能直观）

---

### 5. Wind（御风者）

<div align="center">

**风系控制 | 位移控制 + 聚怪**

</div>

#### 角色定位

御风者通过规划路径冲刺，沿途生成风墙吸附敌人。形成闭环时创造暴风区域，强力聚怪并造成伤害。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 380 |
| 冲刺速度 | 1900 |
| 冲刺伤害 | 18 |
| 最大能量 | 999 |
| 初始能量 | 650 |

#### 技能详解

##### 左键 - 普通冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 快速位移，造成伤害

##### Q技能 - 风墙规划
- **类型**: 规划技能
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键执行冲刺
- **效果**:
  - 沿途生成风墙（持续3秒）
  - 风墙吸附敌人到线段上（吸附力350）
  - 风墙造成15点/tick伤害
  - 如果形成闭环，创造暴风区域（吸向中心，30点/tick伤害，持续3秒）
  - **支持8字形**: 可以画出多个闭合区域
- **视觉**: 规划时青色线条，闭合时变红色
- **画圈奖励**:
  - 小圈（1-2个怪）: 返还80%能量，显示"GOOD!"
  - 中圈（3-9个怪）: 返还50%能量，显示"PERFECT!"
  - 大圈（10+个怪）: +3护甲，+15生命，显示"DIVINE!"

##### E技能 - 暴风眼
- **类型**: 范围控制
- **消耗**: 20能量
- **效果**:
  - 在自身位置生成龙卷风（持续3秒）
  - 强力吸附并伤害敌人
  - 持续推开敌人
- **用途**: 聚怪、防御

#### 玩法技巧

1. **聚怪**: 使用风墙吸附敌人到线段上
2. **暴风区域**: 画闭环创造暴风区域，将敌人吸向中心
3. **8字形技巧**: 画8字形可以同时创造两个暴风区域
4. **配合AOE**: 聚集敌人后使用其他AOE技能清场
5. **防御**: 使用E技能推开近身敌人

#### 适合玩家

- 喜欢控制和聚怪的玩家
- 擅长配合AOE伤害的玩家
- 新手友好（技能直观）

---

### 6. Sapper（工兵）

<div align="center">

**地雷专家 | 陷阱布置 + 区域封锁**

</div>

#### 角色定位

工兵通过规划路径冲刺布置地雷。非闭合路径沿途布雷，闭合路径在区域内密集布雷。地雷触发后爆炸造成范围伤害。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 600 |
| 冲刺速度 | 1500 |
| 冲刺伤害 | 20 |
| 最大能量 | 999 |
| 初始能量 | 550 |

#### 技能详解

##### 左键 - 普通冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**: 快速位移，造成伤害

##### Q技能 - 地雷规划
- **类型**: 规划技能
- **消耗**: 每10像素消耗1能量（超过1800像素后递增）
- **操作**:
  1. 按住Q键进入子弹时间（0.1倍速）
  2. 按住鼠标左键连续划线
  3. 松开Q键执行冲刺
- **效果**:
  - **非闭合路径**: 沿途布置地雷（每50像素一个）
  - **闭合路径**: 在区域内密集布雷（每60像素一个）
  - **支持8字形**: 可以画出多个闭合区域，每个区域独立填充地雷
- **地雷参数**:
  - 伤害: 150
  - 触发半径: 20
  - 爆炸半径: 120
  - 自动爆炸时间: 5秒
- **视觉**: 规划时金黄色线条，闭合时变红色

##### E技能 - 嘲讽图腾
- **类型**: 嘲讽
- **消耗**: 40能量
- **效果**:
  - 放置图腾吸引附近敌人仇恨（持续8秒）
  - 图腾有生命值，被摧毁时爆炸
  - 造成范围伤害
- **用途**: 引导敌人进入雷区

#### 玩法技巧

1. **提前布置**: 在敌人到达前布置地雷
2. **闭环填充**: 画闭环在区域内密集布雷，创造大片雷区
3. **8字形技巧**: 画8字形可以同时填充两个区域
4. **图腾引导**: 使用图腾引导敌人进入雷区
5. **连锁爆炸**: 地雷爆炸可以引爆附近地雷

#### 适合玩家

- 喜欢陷阱和布置的玩家
- 擅长预判和规划的玩家
- 喜欢防御战的玩家

---

### 7. Tempest（风暴使者）

<div align="center">

**雷电法师 | 范围伤害 + 弹幕反射**

</div>

#### 角色定位

风暴使者创造风暴区域，反弹敌人弹幕并触发闪电链。擅长范围伤害和弹幕反制。

#### 基础属性

| 属性 | 数值 |
|------|------|
| 生命值 | 5000 |
| 移动速度 | 500 |
| 冲刺距离 | 350 |
| 冲刺速度 | 1800 |
| 冲刺伤害 | 15 |
| 最大能量 | 999 |
| 初始能量 | 750 |

#### 技能详解

##### 左键 - 风眼冲刺
- **类型**: 基础攻击
- **消耗**: 10能量
- **效果**:
  - 冲刺并造成伤害
  - 冲刺起点生成旋风（吸附敌人）
  - 冲刺结束时，如果在风暴区域内触发闪电链

##### Q技能 - 台风眼
- **类型**: 区域控制
- **消耗**: 30能量
- **效果**:
  - 在鼠标位置创造大范围风暴区域（持续6秒）
  - 强力吸附并持续伤害敌人
  - 反弹敌人弹幕
  - 玩家在区域内获得保护
- **视觉**: 紫色风暴区域

##### E技能 - 狂风龙卷
- **类型**: 范围伤害
- **消耗**: 35能量
- **效果**:
  - 在自身位置生成龙卷风（持续3秒）
  - 持续伤害并推开敌人
  - 造成范围伤害
- **用途**: 清场、防御

#### 特殊机制 - 闪电链

- **触发条件**: 在风暴区域内冲刺结束时触发
- **效果**:
  - 对最近的敌人释放闪电
  - 闪电可弹跳3次
  - 每次造成80点伤害
- **视觉**: 蓝色闪电链

#### 玩法技巧

1. **风暴区域**: 创造风暴区域作为安全区
2. **弹幕反射**: 利用风暴区域反弹敌人弹幕
3. **闪电链**: 在风暴区域内冲刺触发闪电链清场
4. **龙卷防御**: 使用E技能推开近身敌人

#### 适合玩家

- 喜欢范围伤害的玩家
- 擅长利用环境的玩家
- 喜欢弹幕反制的玩家

---

## 公共工具类

### PolygonUtils

所有Q技能的划线闭合检测和遮罩显示逻辑都使用公共工具类 `PolygonUtils`（位于 `autoloads/polygon_utils.gd`）。

#### 主要功能

| 方法 | 说明 |
|------|------|
| `find_all_closing_polygons()` | 检测路径中所有闭合多边形，支持8字形等多区域 |
| `show_closure_masks()` | 同步显示多个遮罩（同时淡入、同时淡出） |
| `ensure_ccw_winding()` | 确保多边形点为逆时针方向 |
| `simplify_polygon()` | 简化多边形，移除过近的点 |

#### 8字形检测原理

当用户画出8字形时，会产生两个交叉点。工具类通过以下步骤提取两个独立的闭合区域：

1. 收集所有线段交叉点
2. 按索引排序交叉点
3. 检测8字形结构（i1 < i2 < j2 < j1）
4. 分别提取上圈和下圈的多边形点

#### 遮罩动画

多个闭合区域的遮罩会同步显示：
- 同时淡入（0.15秒）
- 同时闪光（0.08秒）
- 同时保持显示（0.6秒）
- 同时淡出（0.2秒）

不同区域使用不同颜色区分：
- 区域1: 基础颜色（红/橙/青等，取决于角色）
- 区域2: 蓝色
- 区域3: 黄色
- 区域4: 紫色

---

## 角色属性系统

### 基础属性

所有角色共享以下基础属性（可通过升级提升）：

| 属性 | 说明 | 初始值 |
|------|------|--------|
| 生命值 | 角色的生命值 | 5000 |
| 移动速度 | 角色的移动速度 | 500 |
| 冲刺距离 | 冲刺的距离 | 300-600 |
| 冲刺速度 | 冲刺的速度 | 1200-2000 |
| 冲刺伤害 | 冲刺造成的伤害 | 10-20 |
| 最大能量 | 能量上限 | 999 |
| 初始能量 | 游戏开始时的能量 | 500-800 |
| 能量恢复 | 每秒恢复的能量 | 0.5 |
| 最大护甲 | 护甲上限 | 3 |

### 属性配置

角色属性配置位于 `config/player/player_config.csv`，可以通过修改CSV文件调整角色属性。

---

## 技能系统

### 技能类型

#### 1. 规划技能（Q技能）

- **特点**: 按住Q进入子弹时间（0.1倍速），按住鼠标左键划线，松开Q执行
- **角色**: 所有角色
- **能量消耗**: 每10像素消耗1能量，超过1800像素后递增
- **闭合检测**: 实时检测线段交叉，形成闭合区域时线条变红
- **8字形支持**: 可以画出多个闭合区域，每个区域独立触发效果
- **右键取消**: 按右键清除所有路径并返还能量
- **优势**: 可以精确规划，形成闭环触发特殊效果
- **劣势**: 需要时间规划，执行时无保护

#### 2. 即时技能（E技能）

- **特点**: 按E立即释放
- **角色**: 所有角色
- **优势**: 快速释放，适合紧急情况
- **劣势**: 无法规划，需要时机把握

#### 3. 区域技能

- **特点**: 创造持续伤害或控制区域
- **角色**: Pyro（火海）、Wind（暴风区域）、Sapper（雷区）
- **优势**: 持续效果，无需持续操作
- **劣势**: 固定位置，敌人可以躲避

#### 4. 两阶段技能

- **特点**: 技能分为部署和触发两个阶段
- **角色**: Weaver（编织+收割）、Butcher（发射+手动消除）
- **优势**: 灵活控制时机，可以等待最佳时机触发
- **劣势**: 需要更多操作，时机把握要求高

### 能量管理

- **能量消耗**: Q技能每10像素消耗1能量
- **能量递增**: 超过1800像素后，能量消耗逐渐递增
- **能量恢复**: 每秒自动恢复0.5能量
- **击杀回能**: 可通过升级获得击杀回能属性
- **能量上限**: 可通过升级提升能量上限
- **画圈奖励**: 部分角色（Pyro、Wind）根据圈内敌人数量返还能量

---

## 角色选择建议

### 新手推荐

#### Pyro（烈焰）
- **原因**: 技能直观，火线和火海容易理解
- **优势**: 持续伤害，画圈奖励机制友好
- **难度**: ★★☆☆☆

#### Wind（御风者）
- **原因**: 聚怪能力强，容错率高
- **优势**: 风墙和暴风区域提供控制
- **难度**: ★★☆☆☆

### 进阶推荐

#### Herder（牧者）
- **原因**: 需要规划和预判，高风险高回报
- **优势**: 闭环绞杀可以瞬杀大量敌人
- **难度**: ★★★★☆

#### Weaver（织网者）
- **原因**: 两阶段技能需要时机把握
- **优势**: 处决伤害高，控制能力强
- **难度**: ★★★☆☆

### 高难度推荐

#### Butcher（屠夫）
- **原因**: 需要理解闭合/非闭合两种模式
- **优势**: 捕获敌人能力强，灵活性高
- **难度**: ★★★★☆

#### Sapper（工兵）
- **原因**: 需要提前布置和预判
- **优势**: 大范围雷区，防御能力强
- **难度**: ★★★★☆



## 总结

PolyLash的角色系统设计注重：

1. **多样性**: 7个角色，7种玩法
2. **深度**: 每个角色都有独特的技能机制
3. **平衡**: 所有角色都有优势和劣势
4. **可扩展**: 易于添加新角色

选择适合自己的角色，享受游戏！

更多详细信息请查看其他文档：
- [SYSTEMS.md](SYSTEMS.md) - 游戏系统详解
- [ENEMIES.md](ENEMIES.md) - 敌人系统
- [WEAPONS.md](WEAPONS.md) - 武器系统
- [WAVES.md](WAVES.md) - 波次系统
